# CNC3018
## Содержание
1. Подготовка платы в Kicad
1. Экспорт Gerber файлов
1. Создание gcode с помощью pcb2gcode
1. Подготовка станка
1. Фрезерование дорожек
1. Сверление отверстий
1. Выпил платы
1. ???
1. PROFIT!

## Подготовка платы в Kicad

**Данный туториал не является туториалом по разработке печатных плат в Kicad, здесь описана только подготовка платы к изготовлению.**

### Настройка ограничений 
Перед разводкой платы необходимо указать минимальный зазор (должен быть больше либо равен диаметру фрезы) и минимальную ширину дорожки в меню `Файл > Параметры платы` ![](img/pcb_constraints.png)
### Добавление начала координат и границ
Начало координат будет соответствовать координатам (0; 0) станка, нужно поставить его в нижнем левом углу платы.

Для того, чтобы фрезер мог вырезать плату из большого куска текстолита, нужно обозначить её границу. Для этого необходимо добавить прямоугольник на слой `Edge.Cuts`.
![](img/kicad_pcb_preparation.gif)

## Экспорт Gerber файлов
Для экспорта Gerber фалов нужно выбрать пункт меню `Файл > Файлы для производства > Gerbers`. В открывшемся диалоге нужно:
1. Выбрать папку, в которую будут записаны Gerber файлы
1. Включить `Использовать начало координат сверловки/размещения` (иначе фрезер за начало координат примет нижний левый угол листа в Kicad)
1. Выключить `Использовать расширенный формат X2` (если такой пункт есть)
1. Выбрать слои `F.Cu` (дорожки) и `Edge.Cuts` (граница платы)
1. Нажать `Чертить` ![](img/kicad_export_settings.png)
1. Нажать `Cформировать фалы сверловки`
1. В открывшемся окне нажать `Создать файл сверловки`

## Создание gcode с помощью pcb2gcode
Gerber файлы описывают геометрию платы, gcode файлы - список инструкций вида "перемести ось X на 1 мм". Gcode нужно создавать для конкретного станка и инструментов (фрез, свёрл). Я пробовал две программы для этого - FlatCam и pcb2gcode, но FlatCam не открывает некоторые Gerber файлы, поэтому не будет рассмотрен.

pcb2gcode не имеет графического интерфейса, её настройка проводится через config файл. Пример:
```
# настройки Pcb2GCode
metric=true                     # использовать метрическую систему
metricoutput=true
zero-start=true
zsafe=4                         # высота перемещений инструмента над платой
zchange=5                       # высота, на которой фрезере остановится для смены инструмента
milling-overlap=10%             # наложение проходов фрезы (см. ниже)
output-dir=.                    # путь, куда будет записан gcode
nom6=true                       # иначе фрезер не работает
nog81=true                      # иначе фрезер не работает
nog64=true                      # иначе фрезер не работает
nog91-1=true                    # иначе фрезер не работает
#mirror-axis=1

# Изоляция
zwork=-0.15                     # Рабочая высота (толщина слоя меди, который необходимо убрать)
mill-feed=30                    # скорость перемещения во время фрезерования
mill-speed=200                  # скорость вращения фрезы
mill-diameters=0.7              # диаметр фрезы
isolation-width=1               # ширина изоляции между областями меди (если больше диаметра фрезы, будет совершено несколько проходов)

# Сверление отвепстий
zdrill=-1.48                    # глубина сверления (если под текстолитом есть подложка, ставьте ширину платы + 0.2)
drill-feed=250                  # вертикальная скорость сверления
drill-speed=200                 # скорость вращения сверла
onedrill=1

# Вырезание контура платы
zcut=-1.48                      # глубина вырезания платы
cut-feed=30                     # скорость вырезания платы
cut-speed=200                   # скорость вращения фрезы
cut-infeed=1                    # какую глубину вырезать за 1 проход
cutter-diameter=1mm             # диаметр инструмента
```
Более подробная информация: `man pcb2gcode`.

Чтобы создать gcode, нужно выполнить команду `pcb2gcode --config <путь к файлу настроек> --front tutorial-F_Cu.gbr --drill tutorial-PTH.drl --outline tutorial-Edge_Cuts.gbr`,
где вместо tutorial-*.gbr нужно подставить пути к своим Gerber файлам.

Значения имён файлов:
* F_Cu.gbr - слой меди
* Edge_Cuts.gbr - контур платы
* PTH.drl - покрытые медью отверстия
* NPTH.drl - не покрытые медью отверстия

## Подготовка станка
Для управления станком используется `Universal Gcode Sender`


